# Configuration validation rules
validation:
  enabled: true
  strict_mode: false  # If true, fails on warnings; if false, continues with warnings
  schema_version: "1.0.0"
  
  # Port validation
  port_ranges:
    system_port: [1024, 65535]
    kolosal_server_port: [1024, 65535]
  
  # Memory validation
  memory_limits:
    min_system_memory: "1GB"
    max_memory_percent: 90
    min_cache_size: "64MB"
  
  # Timeout validation
  timeout_limits:
    min_timeout: 1000   # 1 second
    max_timeout: 300000 # 5 minutes
    default_timeout: 30000
  
  # Model validation
  model_requirements:
    require_default_model: true
    require_embedding_model: true
    validate_model_files: true
    check_model_compatibility: true
  
  # Agent validation
  agent_requirements:
    min_agents: 1
    max_agents: 50
    required_capabilities: ["chat"]
  
  # Function validation
  function_requirements:
    min_functions: 3
    required_functions: ["chat", "status", "analyze"]
    validate_parameters: true

# Kolosal Agent System Configuration
system:
  name: "Kolosal Agent System"
  version: "1.0.0"
  host: ${KOLOSAL_HOST:-127.0.0.1}
  port: ${KOLOSAL_PORT:-8080}
  log_level: ${KOLOSAL_LOG_LEVEL:-info}
  max_concurrent_requests: ${KOLOSAL_MAX_REQUESTS:-100}

# System instruction/prompt that will be used for all agents
system_instruction: |
  You are a helpful AI assistant that is part of the Kolosal Agent System. You have been designed to assist users with various tasks including:
  
  - Answering questions and providing information
  - Analyzing text and data
  - Helping with research and problem-solving
  - Providing explanations and tutorials
  - Assisting with creative tasks
  
  You should always:
  - Be helpful, accurate, and honest
  - Admit when you don't know something
  - Provide clear and well-structured responses
  - Be respectful and professional
  - Follow ethical guidelines
  
  Your responses should be informative and helpful while being concise when appropriate.

# Model configuration for agents - maps to actual model files available
models:
  - name: "default"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    server_url: "http://127.0.0.1:8081"
    description: "Default LLM model (Qwen3-0.6B Instruct)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    server_url: "http://127.0.0.1:8081"
    description: "Qwen3-0.6B Instruct language model"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b-instruct"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    server_url: "http://127.0.0.1:8081"
    description: "Qwen3-0.6B Instruct language model (alias)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b-instruct-q4_k_m"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    server_url: "http://127.0.0.1:8081"
    description: "Qwen3-0.6B Instruct language model (original alias)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "embedding"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    server_url: "http://127.0.0.1:8081"
    description: "Embedding model for document vectorization and semantic search"
    preload: true
    embedding_size: 384
  
  - name: "all-MiniLM-L6-v2-bf16-q4_k"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    server_url: "http://127.0.0.1:8081"
    description: "Alternative name for embedding model"
    preload: true
    embedding_size: 384
  
  - name: "text-embedding-3-small"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    server_url: "http://127.0.0.1:8081"
    description: "Alias for embedding model to match expected name"
    preload: true
    embedding_size: 384

# Default agents to create on startup
agents:
  - name: "Assistant"
    capabilities: ["chat", "analysis", "reasoning"]
    auto_start: true
    system_prompt: |
      You are an AI assistant specialized in general conversation and help. 
      You excel at answering questions, providing explanations, and helping users with various tasks.
      Be friendly, helpful, and informative in your responses.
  
  - name: "Analyzer" 
    capabilities: ["analysis", "data_processing", "summarization"]
    auto_start: true
    system_prompt: |
      You are an AI analyst specialized in text and data analysis.
      Your role is to examine, process, and summarize information effectively.
      Provide detailed analysis with clear insights and actionable conclusions.

  - name: "Researcher"
    capabilities: ["research", "web_search", "fact_checking", "retrieval"]
    auto_start: false
    retrieval:
      server_url: "http://127.0.0.1:8081"
      timeout_seconds: 30
      max_retries: 3
      search_enabled: true
      max_results: 20
    system_prompt: |
      You are an AI researcher specialized in information gathering and fact-checking.
      Your role is to help users find accurate information and verify facts.
      Always cite sources when possible and present information objectively.

  - name: "RetrievalAgent"
    capabilities: ["retrieval", "semantic_search", "knowledge_base", "vector_search"]
    auto_start: true
    retrieval:
      server_url: "http://127.0.0.1:8081"
      timeout_seconds: 30
      max_retries: 3
      search_enabled: true
      max_results: 10
    system_prompt: |
      You are an AI agent specialized in information retrieval and document management.
      Your primary functions include:
      - Performing semantic search across document collections
      - Retrieving relevant information based to user queries
      - Maintaining knowledge bases and document repositories
      - Providing context-aware responses using retrieved information
      
      You excel at finding relevant information quickly and accurately, 
      understanding document relationships, and presenting retrieved information 
      in a clear and organized manner. Always provide source references 
      when returning information from documents.

  - name: "DeepResearcher"
    capabilities: ["deep_research", "iterative_search", "fact_verification", "research_planning", "synthesis", "retrieval", "semantic_search"]
    auto_start: false
    retrieval:
      server_url: "http://127.0.0.1:8081"
      timeout_seconds: 60
      max_retries: 3
      search_enabled: true
      max_results: 15
    system_prompt: |
      You are an AI agent specialized in comprehensive deep research and analysis.
      Your primary functions include:
      - Planning multi-phase research strategies based on query complexity
      - Conducting iterative research with progressive refinement
      - Cross-validating information from multiple sources
      - Identifying research gaps and conducting targeted follow-up research
      - Synthesizing complex information from diverse sources
      - Fact-checking and source verification
      - Generating comprehensive research reports with proper citations
      
      You approach research systematically, ensuring thoroughness, accuracy, and 
      objectivity. You excel at breaking down complex topics into researchable 
      components and building comprehensive understanding through iterative investigation.

  - name: "LLMOnlyAgent"
    capabilities: ["chat"]
    auto_start: true
    system_prompt: |
      You are a pure LLM-based AI assistant without any integrated tools or external capabilities.
      Your role is focused solely on:
      - Natural language conversation and dialogue
      - Text-based reasoning and analysis using only your training data
      - Providing information from your knowledge cutoff
      - Creative writing and content generation
      - Language translation and text manipulation
      - Mathematical calculations and logical reasoning
      
      You do not have access to:
      - Internet search or web browsing
      - Document retrieval systems
      - External APIs or tools
      - Real-time data or current events beyond your training
      - File system access or data storage
      
      Focus on providing helpful responses using only your built-in language model capabilities.
      Be transparent about your limitations and knowledge cutoff when relevant.

# Available functions that agents can execute
functions:
  chat:
    description: "Interactive chat functionality with AI model support"
    timeout: 30000
    parameters:
      - name: "message"
        type: "string"
        required: true
        description: "Message to send to the agent"
      - name: "model"
        type: "string"
        required: true
        description: "Name of the AI model to use for chat"
  
  analyze:
    description: "Text and data analysis functionality with optional AI assistance"
    timeout: 60000
    parameters:
      - name: "text"
        type: "string"
        required: true
        description: "Text to analyze"
      - name: "model"
        type: "string"
        required: false
        description: "Name of the AI model to use for enhanced analysis"
      - name: "analysis_type"
        type: "string"
        required: false
        description: "Type of analysis to perform (sentiment, summary, keywords, etc.)"
  
  research:
    description: "Research and information gathering"
    timeout: 120000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Research query or topic"
      - name: "depth"
        type: "string"
        required: false
        description: "Research depth (basic, detailed, comprehensive)"
  
  echo:
    description: "Echo function for testing"
    timeout: 5000
    parameters:
      - name: "data"
        type: "any"
        required: false
        description: "Data to echo back"
  
  status:
    description: "Agent status information"
    timeout: 5000
    parameters: []

  # Retrieval and document management functions
  search_documents:
    description: "Search for documents using semantic similarity"
    timeout: 30000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query to find relevant documents"
      - name: "limit"
        type: "integer"
        required: false
        description: "Maximum number of results to return (default: 10)"
      - name: "threshold"
        type: "number"
        required: false
        description: "Minimum similarity score threshold (0.0-1.0)"
      - name: "filter"
        type: "object"
        required: false
        description: "Metadata filters to apply to the search"

  list_documents:
    description: "List all documents in the vector database"
    timeout: 30000
    parameters:
      - name: "offset"
        type: "integer"
        required: false
        description: "Number of documents to skip (for pagination)"
      - name: "limit"
        type: "integer"
        required: false
        description: "Maximum number of documents to return"
      - name: "filter"
        type: "object"
        required: false
        description: "Metadata filters to apply"

  internet_search:
    description: "Search the internet for information"
    timeout: 60000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query for internet search"
      - name: "results"
        type: "integer"
        required: false
        description: "Number of search results to return (default: 10)"
      - name: "language"
        type: "string"
        required: false
        description: "Language for search results (default: en)"

  retrieve_and_answer:
    description: "Retrieve relevant documents and provide an AI-generated answer"
    timeout: 90000
    parameters:
      - name: "question"
        type: "string"
        required: true
        description: "Question to answer using retrieved documents"
      - name: "model"
        type: "string"
        required: true
        description: "AI model to use for generating the answer"
      - name: "max_docs"
        type: "integer"
        required: false
        description: "Maximum number of documents to retrieve for context"
      - name: "include_sources"
        type: "boolean"
        required: false
        description: "Whether to include source references in the answer"

  # Enhanced retrieval functions
  analyze_document:
    description: "Analyze document structure and extract metadata"
    timeout: 30000
    parameters:
      - name: "content"
        type: "string"
        required: true
        description: "Document content to analyze"

  organize_documents:
    description: "Organize documents by similarity clustering"
    timeout: 60000
    parameters:
      - name: "threshold"
        type: "number"
        required: false
        description: "Similarity threshold for clustering (0.0-1.0, default: 0.8)"
      - name: "max_clusters"
        type: "integer"
        required: false
        description: "Maximum number of clusters to create (default: 10)"

  extract_knowledge_graph:
    description: "Extract knowledge graph from a collection of documents"
    timeout: 90000
    parameters:
      - name: "documents"
        type: "array"
        required: true
        description: "Array of documents to analyze for knowledge extraction"

  get_search_suggestions:
    description: "Generate search query suggestions based on input"
    timeout: 10000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Base query to generate suggestions for"

  # Deep Research Functions
  plan_research:
    description: "Plan a comprehensive research strategy based on query complexity"
    timeout: 120000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Primary research question or topic"
      - name: "research_scope"
        type: "string"
        required: false
        description: "Scope of research (narrow, broad, comprehensive)"
      - name: "depth_level"
        type: "string"
        required: false
        description: "Research depth level (basic, intermediate, advanced, expert)"

  targeted_research:
    description: "Conduct focused research on specific aspects or gaps"
    timeout: 240000
    parameters:
      - name: "research_gaps"
        type: "array"
        required: true
        description: "List of specific topics or questions that need research"
      - name: "search_terms"
        type: "array"
        required: true
        description: "Specific search terms to use for targeted research"
      - name: "sources"
        type: "array"
        required: false
        description: "Preferred sources or domains to search"

  verify_facts:
    description: "Cross-validate and verify facts from multiple sources"
    timeout: 180000
    parameters:
      - name: "findings"
        type: "array"
        required: true
        description: "List of findings or claims to verify"
      - name: "sources"
        type: "array"
        required: true
        description: "Sources to use for verification"
      - name: "verification_depth"
        type: "string"
        required: false
        description: "Depth of verification (basic, thorough, comprehensive)"

  synthesize_research:
    description: "Synthesize information from multiple research sources and identify gaps"
    timeout: 180000
    parameters:
      - name: "primary_data"
        type: "object"
        required: true
        description: "Primary research data to synthesize"
      - name: "knowledge_base_data"
        type: "object"
        required: false
        description: "Additional data from knowledge base"
      - name: "synthesis_type"
        type: "string"
        required: false
        description: "Type of synthesis (comparative, thematic, chronological)"

  generate_research_report:
    description: "Generate comprehensive research report with citations"
    timeout: 120000
    parameters:
      - name: "research_data"
        type: "object"
        required: true
        description: "Compiled research data and findings"
      - name: "analysis_results"
        type: "object"
        required: true
        description: "Analysis results from deep analysis phase"
      - name: "report_format"
        type: "string"
        required: false
        description: "Format of the report (academic, business, summary, detailed)"
      - name: "include_citations"
        type: "boolean"
        required: false
        description: "Whether to include source citations"

  cross_reference_search:
    description: "Search across multiple databases and cross-reference results"
    timeout: 180000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query to cross-reference"
      - name: "databases"
        type: "array"
        required: false
        description: "List of databases to search (internet, knowledge_base, documents)"
      - name: "correlation_threshold"
        type: "number"
        required: false
        description: "Minimum correlation score for cross-referencing (0.0-1.0)"

  iterative_search_refinement:
    description: "Iteratively refine search based on previous results"
    timeout: 240000
    parameters:
      - name: "initial_query"
        type: "string"
        required: true
        description: "Initial search query"
      - name: "previous_results"
        type: "object"
        required: true
        description: "Results from previous search iterations"
      - name: "refinement_strategy"
        type: "string"
        required: false
        description: "Strategy for refinement (narrow, broaden, pivot, clarify)"

  source_credibility_analysis:
    description: "Analyze and score the credibility of information sources"
    timeout: 60000
    parameters:
      - name: "sources"
        type: "array"
        required: true
        description: "List of sources to analyze for credibility"
      - name: "criteria"
        type: "array"
        required: false
        description: "Criteria for credibility assessment"

# Performance and resource configuration with dynamic detection
performance:
  max_memory_usage: "auto"  # Auto-detect system memory, fallback to 2GB
  min_memory_required: "512MB"
  max_memory_percent: 75  # Maximum percentage of system memory to use
  cache_size: "auto"  # Auto-calculate based on available memory
  min_cache_size: "128MB"
  max_cache_size: "1GB"
  worker_threads: "auto"  # Auto-detect based on CPU cores
  min_worker_threads: 2
  max_worker_threads: 16
  request_timeout: 30000
  max_request_size: "10MB"
  disk_space_monitoring:
    enabled: true
    min_free_space: "1GB"
    warning_threshold: "2GB"
    check_interval: 300  # seconds
  resource_limits:
    cpu_usage_threshold: 80  # percentage
    memory_usage_threshold: 85  # percentage
    disk_usage_threshold: 90  # percentage
  graceful_degradation:
    enabled: true
    reduce_cache_on_memory_pressure: true
    reduce_workers_on_cpu_pressure: true
    queue_limit_on_resource_pressure: 50

# Kolosal Server configuration
kolosal_server:
  auto_start: ${KOLOSAL_SERVER_AUTO_START:-true}
  startup_timeout: ${KOLOSAL_SERVER_STARTUP_TIMEOUT:-60}
  health_check_interval: ${KOLOSAL_SERVER_HEALTH_INTERVAL:-10}
  max_retries: ${KOLOSAL_SERVER_MAX_RETRIES:-3}
  retry_delay: ${KOLOSAL_SERVER_RETRY_DELAY:-2000}
  resource_limits:
    max_memory: ${KOLOSAL_SERVER_MAX_MEMORY:-1.5GB}
    max_cpu_percent: ${KOLOSAL_SERVER_MAX_CPU:-80}
  models_directory: ${KOLOSAL_MODEL_PATH:-./models}
  required_models:
    - name: ${KOLOSAL_LLM_MODEL_NAME:-qwen2.5-0.5b-instruct-q4_k_m}
      file: ${KOLOSAL_LLM_MODEL_FILE:-qwen2.5-0.5b-instruct-q4_k_m.gguf}
      type: "llm"
      required: true
    - name: ${KOLOSAL_EMBEDDING_MODEL_NAME:-all-MiniLM-L6-v2-bf16-q4_k}
      file: ${KOLOSAL_EMBEDDING_MODEL_FILE:-all-MiniLM-L6-v2-bf16-q4_k.gguf}
      type: "embedding"
      required: true
  model_preload_timeout: ${KOLOSAL_MODEL_PRELOAD_TIMEOUT:-120}
  graceful_shutdown_timeout: ${KOLOSAL_SHUTDOWN_TIMEOUT:-30}

# Logging configuration
logging:
  level: ${KOLOSAL_LOG_LEVEL:-info}
  file: ${KOLOSAL_LOG_FILE:-agent_system.log}
  max_file_size: ${KOLOSAL_LOG_MAX_SIZE:-100MB}
  max_files: ${KOLOSAL_LOG_MAX_FILES:-10}
  console_output: ${KOLOSAL_LOG_CONSOLE:-true}

# Error handling and fallback configuration
error_handling:
  enable_fallbacks: true
  fallback_responses: true
  graceful_degradation: true
  max_retry_attempts: 0  # Do not retry, just show the result
  retry_backoff_multiplier: 1.0
  timeout_escalation: false
  offline_mode:
    enable: true
    cache_responses: true
    max_cache_size: "100MB"
  
# Circuit breaker configuration for server reliability
circuit_breaker:
  failure_threshold: 100  # Effectively disables circuit breaking
  recovery_timeout: 1
  half_open_max_calls: 100
  metrics_window: 1
