# Configuration validation rules
validation:
  enabled: true
  strict_mode: false  # If true, fails on warnings; if false, continues with warnings
  schema_version: "1.0.0"
  
  # Port validation
  port_ranges:
    system_port: [1024, 65535]
    kolosal_server_port: [1024, 65535]
  
  # Memory validation
  memory_limits:
    min_system_memory: "1GB"
    max_memory_percent: 90
    min_cache_size: "64MB"
  
  # Timeout validation
  timeout_limits:
    min_timeout: 1000   # 1 second
    max_timeout: 300000 # 5 minutes
    default_timeout: 30000
  
  # Model validation
  model_requirements:
    require_default_model: true
    require_embedding_model: true
    validate_model_files: true
    check_model_compatibility: true
  
  # Agent validation
  agent_requirements:
    min_agents: 1
    max_agents: 50
    required_capabilities: ["chat"]
  
  # Function validation
  function_requirements:
    min_functions: 3
    required_functions: ["chat", "status", "analyze"]
    validate_parameters: true

# Server configuration
server:
  host: ${KOLOSAL_SERVER_HOST:-127.0.0.1}
  port: ${KOLOSAL_SERVER_PORT:-8081}
  idle_timeout: ${KOLOSAL_SERVER_IDLE_TIMEOUT:-300}
  allow_public_access: ${KOLOSAL_SERVER_PUBLIC_ACCESS:-false}
  allow_internet_access: ${KOLOSAL_SERVER_INTERNET_ACCESS:-true}

# Kolosal Agent System Configuration
system:
  name: "Kolosal Agent System"
  version: "1.0.0"
  host: ${KOLOSAL_HOST:-127.0.0.1}
  port: ${KOLOSAL_PORT:-8081}
  log_level: ${KOLOSAL_LOG_LEVEL:-info}
  max_concurrent_requests: ${KOLOSAL_MAX_REQUESTS:-100}

# Model configuration for agents - maps to actual model files available
models:
  - name: "default"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    description: "Default LLM model (Qwen3-0.6B Instruct)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    description: "Qwen3-0.6B Instruct language model"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b-instruct"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    description: "Qwen3-0.6B Instruct language model (alias)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "qwen2.5-0.5b-instruct-q4_k_m"
    actual_name: "qwen3-0.6b:UD-Q4_K_XL"
    model_file: "Qwen3-0.6B-UD-Q4_K_XL.gguf"
    type: "llm"
    description: "Qwen3-0.6B Instruct language model (original alias)"
    preload: true
    context_size: 2048
    max_tokens: 1024
    temperature: 0.7
    top_p: 0.9
  
  - name: "embedding"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    description: "Embedding model for document vectorization and semantic search"
    preload: true
    embedding_size: 384
  
  - name: "all-MiniLM-L6-v2-bf16-q4_k"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    description: "Alternative name for embedding model"
    preload: true
    embedding_size: 384
  
  - name: "text-embedding-3-small"
    actual_name: "all-MiniLM-L6-v2-bf16-q4_k"
    model_file: "all-MiniLM-L6-v2-bf16-q4_k.gguf"
    type: "embedding"
    description: "Alias for embedding model to match expected name"
    preload: true
    embedding_size: 384

# Default agents to create on startup
agents:
  # 1. LLM Only Agent - Pure language model without external capabilities
  - name: "LLMOnly"
    capabilities: ["chat", "analysis", "reasoning"]
    auto_start: true
    model: "default"
    system_prompt: |
      You are a pure LLM-based AI assistant without any integrated tools or external capabilities.
      Your role is focused solely on:
      - Natural language conversation and dialogue
      - Text-based reasoning and analysis using only your training data
      - Providing information from your knowledge cutoff
      - Creative writing and content generation
      - Language translation and text manipulation
      - Mathematical calculations and logical reasoning
      
      You do not have access to:
      - Internet search or web browsing
      - Document retrieval systems
      - External APIs or tools
      - Real-time data or current events beyond your training
      - File system access or data storage
      
      Focus on providing helpful responses using only your built-in language model capabilities.
      Be transparent about your limitations and knowledge cutoff when relevant.

  # 2. LLM with Search Agent - Uses Kolosal search capabilities
  - name: "LLMWithSearch"
    capabilities: ["chat", "web_search", "internet_search", "fact_checking"]
    auto_start: true
    model: "default"
    search:
      enabled: true
      timeout_seconds: 30
      max_retries: 3
      max_results: 10
      use_kolosal_search: true
    system_prompt: |
      You are an AI assistant equipped with internet search capabilities through Kolosal search.
      Your primary functions include:
      - Natural language conversation enhanced with real-time information
      - Internet search and web browsing to gather current information
      - Fact-checking using live web sources
      - Providing up-to-date information beyond your training cutoff
      - Combining your knowledge with current web-based information
      
      Search capabilities:
      - Real-time web search using Kolosal search engine
      - Access to current news, articles, and web content
      - Ability to verify and cross-reference information
      - Support for multi-query search strategies
      
      Always cite sources when using information from searches and be clear about
      the distinction between your training knowledge and information gathered from searches.

  # 3. LLM with Retrieval Agent - Uses FAISS for document retrieval
  - name: "LLMWithRetrieval"
    capabilities: ["chat", "retrieval", "semantic_search", "knowledge_base", "vector_search", "document_analysis"]
    auto_start: true
    model: "default"
    embedding_model: "embedding"
    retrieval:
      enabled: true
      timeout_seconds: 30
      max_retries: 3
      search_enabled: true
      max_results: 10
      use_faiss: true
      vector_store: "faiss"
      similarity_threshold: 0.7
      embedding_model: "embedding"
    system_prompt: |
      You are an AI assistant equipped with advanced document retrieval capabilities using FAISS vector search.
      Your primary functions include:
      - Natural language conversation enhanced with document knowledge
      - Semantic search across indexed document collections
      - Vector-based similarity matching for precise information retrieval
      - Knowledge base management and document analysis
      - Context-aware responses using retrieved document fragments
      
      Retrieval capabilities:
      - FAISS-powered vector search for high-performance similarity matching
      - Semantic understanding of document content and relationships
      - Multi-document synthesis and cross-referencing
      - Metadata filtering and advanced search strategies
      - Real-time document indexing and retrieval
      
      You excel at finding relevant information from document collections,
      understanding document relationships, and presenting retrieved information
      in a clear and organized manner. Always provide source references and
      document citations when returning information from the knowledge base.

# Available functions that agents can execute
functions:
  chat:
    description: "Interactive chat functionality with AI model support"
    timeout: 30000
    parameters:
      - name: "message"
        type: "string"
        required: true
        description: "Message to send to the agent"
      - name: "model"
        type: "string"
        required: true
        description: "Name of the AI model to use for chat"
  
  analyze:
    description: "Text and data analysis functionality with optional AI assistance"
    timeout: 60000
    parameters:
      - name: "text"
        type: "string"
        required: true
        description: "Text to analyze"
      - name: "model"
        type: "string"
        required: false
        description: "Name of the AI model to use for enhanced analysis"
      - name: "analysis_type"
        type: "string"
        required: false
        description: "Type of analysis to perform (sentiment, summary, keywords, etc.)"
  
  research:
    description: "Research and information gathering"
    timeout: 120000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Research query or topic"
      - name: "depth"
        type: "string"
        required: false
        description: "Research depth (basic, detailed, comprehensive)"
  
  echo:
    description: "Echo function for testing"
    timeout: 5000
    parameters:
      - name: "data"
        type: "any"
        required: false
        description: "Data to echo back"
  
  status:
    description: "Agent status information"
    timeout: 5000
    parameters: []

  # Retrieval and document management functions
  search_documents:
    description: "Search for documents using semantic similarity"
    timeout: 30000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query to find relevant documents"
      - name: "limit"
        type: "integer"
        required: false
        description: "Maximum number of results to return (default: 10)"
      - name: "threshold"
        type: "number"
        required: false
        description: "Minimum similarity score threshold (0.0-1.0)"
      - name: "filter"
        type: "object"
        required: false
        description: "Metadata filters to apply to the search"

  list_documents:
    description: "List all documents in the vector database"
    timeout: 30000
    parameters:
      - name: "offset"
        type: "integer"
        required: false
        description: "Number of documents to skip (for pagination)"
      - name: "limit"
        type: "integer"
        required: false
        description: "Maximum number of documents to return"
      - name: "filter"
        type: "object"
        required: false
        description: "Metadata filters to apply"

  internet_search:
    description: "Search the internet for information"
    timeout: 60000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query for internet search"
      - name: "results"
        type: "integer"
        required: false
        description: "Number of search results to return (default: 10)"
      - name: "language"
        type: "string"
        required: false
        description: "Language for search results (default: en)"

  retrieve_and_answer:
    description: "Retrieve relevant documents and provide an AI-generated answer"
    timeout: 90000
    parameters:
      - name: "question"
        type: "string"
        required: true
        description: "Question to answer using retrieved documents"
      - name: "model"
        type: "string"
        required: true
        description: "AI model to use for generating the answer"
      - name: "max_docs"
        type: "integer"
        required: false
        description: "Maximum number of documents to retrieve for context"
      - name: "include_sources"
        type: "boolean"
        required: false
        description: "Whether to include source references in the answer"

  # Enhanced retrieval functions
  analyze_document:
    description: "Analyze document structure and extract metadata"
    timeout: 30000
    parameters:
      - name: "content"
        type: "string"
        required: true
        description: "Document content to analyze"

  organize_documents:
    description: "Organize documents by similarity clustering"
    timeout: 60000
    parameters:
      - name: "threshold"
        type: "number"
        required: false
        description: "Similarity threshold for clustering (0.0-1.0, default: 0.8)"
      - name: "max_clusters"
        type: "integer"
        required: false
        description: "Maximum number of clusters to create (default: 10)"

  extract_knowledge_graph:
    description: "Extract knowledge graph from a collection of documents"
    timeout: 90000
    parameters:
      - name: "documents"
        type: "array"
        required: true
        description: "Array of documents to analyze for knowledge extraction"

  get_search_suggestions:
    description: "Generate search query suggestions based on input"
    timeout: 10000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Base query to generate suggestions for"

  # Deep Research Functions
  plan_research:
    description: "Plan a comprehensive research strategy based on query complexity"
    timeout: 120000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Primary research question or topic"
      - name: "research_scope"
        type: "string"
        required: false
        description: "Scope of research (narrow, broad, comprehensive)"
      - name: "depth_level"
        type: "string"
        required: false
        description: "Research depth level (basic, intermediate, advanced, expert)"

  targeted_research:
    description: "Conduct focused research on specific aspects or gaps"
    timeout: 240000
    parameters:
      - name: "research_gaps"
        type: "array"
        required: true
        description: "List of specific topics or questions that need research"
      - name: "search_terms"
        type: "array"
        required: true
        description: "Specific search terms to use for targeted research"
      - name: "sources"
        type: "array"
        required: false
        description: "Preferred sources or domains to search"

  verify_facts:
    description: "Cross-validate and verify facts from multiple sources"
    timeout: 180000
    parameters:
      - name: "findings"
        type: "array"
        required: true
        description: "List of findings or claims to verify"
      - name: "sources"
        type: "array"
        required: true
        description: "Sources to use for verification"
      - name: "verification_depth"
        type: "string"
        required: false
        description: "Depth of verification (basic, thorough, comprehensive)"

  synthesize_research:
    description: "Synthesize information from multiple research sources and identify gaps"
    timeout: 180000
    parameters:
      - name: "primary_data"
        type: "object"
        required: true
        description: "Primary research data to synthesize"
      - name: "knowledge_base_data"
        type: "object"
        required: false
        description: "Additional data from knowledge base"
      - name: "synthesis_type"
        type: "string"
        required: false
        description: "Type of synthesis (comparative, thematic, chronological)"

  generate_research_report:
    description: "Generate comprehensive research report with citations"
    timeout: 120000
    parameters:
      - name: "research_data"
        type: "object"
        required: true
        description: "Compiled research data and findings"
      - name: "analysis_results"
        type: "object"
        required: true
        description: "Analysis results from deep analysis phase"
      - name: "report_format"
        type: "string"
        required: false
        description: "Format of the report (academic, business, summary, detailed)"
      - name: "include_citations"
        type: "boolean"
        required: false
        description: "Whether to include source citations"

  cross_reference_search:
    description: "Search across multiple databases and cross-reference results"
    timeout: 180000
    parameters:
      - name: "query"
        type: "string"
        required: true
        description: "Search query to cross-reference"
      - name: "databases"
        type: "array"
        required: false
        description: "List of databases to search (internet, knowledge_base, documents)"
      - name: "correlation_threshold"
        type: "number"
        required: false
        description: "Minimum correlation score for cross-referencing (0.0-1.0)"

  iterative_search_refinement:
    description: "Iteratively refine search based on previous results"
    timeout: 240000
    parameters:
      - name: "initial_query"
        type: "string"
        required: true
        description: "Initial search query"
      - name: "previous_results"
        type: "object"
        required: true
        description: "Results from previous search iterations"
      - name: "refinement_strategy"
        type: "string"
        required: false
        description: "Strategy for refinement (narrow, broaden, pivot, clarify)"

  source_credibility_analysis:
    description: "Analyze and score the credibility of information sources"
    timeout: 60000
    parameters:
      - name: "sources"
        type: "array"
        required: true
        description: "List of sources to analyze for credibility"
      - name: "criteria"
        type: "array"
        required: false
        description: "Criteria for credibility assessment"

# Performance and resource configuration with dynamic detection
performance:
  max_memory_usage: "auto"  # Auto-detect system memory, fallback to 2GB
  min_memory_required: "512MB"
  max_memory_percent: 75  # Maximum percentage of system memory to use
  cache_size: "auto"  # Auto-calculate based on available memory
  min_cache_size: "128MB"
  max_cache_size: "1GB"
  worker_threads: "auto"  # Auto-detect based on CPU cores
  min_worker_threads: 2
  max_worker_threads: 16
  request_timeout: 30000
  max_request_size: "10MB"
  disk_space_monitoring:
    enabled: true
    min_free_space: "1GB"
    warning_threshold: "2GB"
    check_interval: 300  # seconds
  resource_limits:
    cpu_usage_threshold: 80  # percentage
    memory_usage_threshold: 85  # percentage
    disk_usage_threshold: 90  # percentage
  graceful_degradation:
    enabled: true
    reduce_cache_on_memory_pressure: true
    reduce_workers_on_cpu_pressure: true
    queue_limit_on_resource_pressure: 50

# Kolosal Server configuration
kolosal_server:
  auto_start: ${KOLOSAL_SERVER_AUTO_START:-true}
  startup_timeout: ${KOLOSAL_SERVER_STARTUP_TIMEOUT:-60}
  health_check_interval: ${KOLOSAL_SERVER_HEALTH_INTERVAL:-10}
  max_retries: ${KOLOSAL_SERVER_MAX_RETRIES:-3}
  retry_delay: ${KOLOSAL_SERVER_RETRY_DELAY:-2000}
  resource_limits:
    max_memory: ${KOLOSAL_SERVER_MAX_MEMORY:-1.5GB}
    max_cpu_percent: ${KOLOSAL_SERVER_MAX_CPU:-80}
  models_directory: ${KOLOSAL_MODEL_PATH:-./models}
  required_models:
    - name: ${KOLOSAL_LLM_MODEL_NAME:-qwen2.5-0.5b-instruct-q4_k_m}
      file: ${KOLOSAL_LLM_MODEL_FILE:-qwen2.5-0.5b-instruct-q4_k_m.gguf}
      type: "llm"
      required: true
    - name: ${KOLOSAL_EMBEDDING_MODEL_NAME:-all-MiniLM-L6-v2-bf16-q4_k}
      file: ${KOLOSAL_EMBEDDING_MODEL_FILE:-all-MiniLM-L6-v2-bf16-q4_k.gguf}
      type: "embedding"
      required: true
  model_preload_timeout: ${KOLOSAL_MODEL_PRELOAD_TIMEOUT:-120}
  graceful_shutdown_timeout: ${KOLOSAL_SHUTDOWN_TIMEOUT:-30}

# Logging configuration
logging:
  level: ${KOLOSAL_LOG_LEVEL:-info}
  file: ${KOLOSAL_LOG_FILE:-agent_system.log}
  max_file_size: ${KOLOSAL_LOG_MAX_SIZE:-100MB}
  max_files: ${KOLOSAL_LOG_MAX_FILES:-10}
  console_output: ${KOLOSAL_LOG_CONSOLE:-true}

# Error handling and fallback configuration
error_handling:
  enable_fallbacks: true
  fallback_responses: true
  graceful_degradation: true
  max_retry_attempts: 0  # Do not retry, just show the result
  retry_backoff_multiplier: 1.0
  timeout_escalation: false
  offline_mode:
    enable: true
    cache_responses: true
    max_cache_size: "100MB"
  
# Circuit breaker configuration for server reliability
circuit_breaker:
  failure_threshold: 100  # Effectively disables circuit breaking
  recovery_timeout: 1
  half_open_max_calls: 100
  metrics_window: 1
